# Laser Stramash Network Protocol

LaserStramash uses MQTT to pass messages between guns and servers. 

TODO: example message workflow.

## Topic Naming Convention

The top-level topic name is always *stramash*. This enables Stramash
traffic to coexist comfortable with other traffic sharing the MQTT
server, and also makes it easy for software to subscribe to all
Stramash-related messages.

Most topics have the game ID as the next level in the topic:

    stramash/<gameid>/<topic>

The intention here is to allow for multiple games running simultaneously
on the same infrastructure, making it easy for guns, sensors, game
monitors and so on to only subscribe to messages relating to a
particular game. The exceptions are the messages relating to
creation of new games (where no game ID exists yet), as well as messages 
relating to a player not yet enrolled with a game.

The game ID for a given game is a string and should be unique (at least
across a given MQTT and Stramash server infrastructure). In the
proof-of-concept it is generated with this Python code:

    alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"
    return ''.join(random.choices(alphabet, k=length))

## Message Conventions

The messages themselves (data payload) are JSON-formatted. The following
three key patterns are used:

### Single-Value Messages

The simplest messages which include only one datum are sent as JSON
simple types. The following JSON simple types are used:

-   numbers
-   strings
-   booleans (true or false)
-   null

An example is the **fire** message, which tells the server when a gun
has fired. The message is simply the ID of the player firing, an
integer:

    2

### Descriptive Messages

More complex messages are sent as JSON objects. A JSON object is a set
of name-value pairs. The name and value are separated by a colon ( : ),
the pairs are separated by commas and enclosed with braces ( {} ). For
example, this is the message sent to create a new game for the World
Laser Tag final, a Battle Royale game lasting for one hour:

    {
    "name": "World Laser Tag Final",
    "type": "battle royale",
    "maxtime": "01:00:00"
    }

JSON generated by the Stramash server will typically omit whitespace to
minimise network traffic, but the server will happily receive valid JSON messages
containing whitespace.

### High-Frequency Messages

The **hit** message includes five data, the network and player ID of the 
shooter, the network and player ID of the victim, and the ID of the sensor 
recording the hit. Naturally, they could be sent as a descriptive message:

    {
    "shooter_team": 2,
    “shooter_id”: 1,
    "victim_team": 1,
    “victim_id”: 3,
    "sensor": 1
    }

However, because these messages are (hopefully) being transmitted
frequently, the result is significant traffic and more overhead on the
limited processing capacity of guns and sensors. These messages are sent
as JSON arrays, a set of ordered simple values separated by commas and
wrapped in square brackets. For example, the above message would
actually be rendered as follows:

    [2,1,1,3,1]

## Messages

### Game-Related Messages

**New Game**

Topic: `stramash/newgame`

Message Format:
>    {
       "name": \<game name\>,  
        "type": \<game type - ffa|teams|br etc\>,  
        "maxtime": <max time hh:mm:ss>,        
    }

Requests the creation of a new game.

    name: descriptive name for the game
    type: the type of the game to be played
    maxtime: the maximum duration for the game.

The basic message simply creates the new game, without specifying teams or 
players. These can be added with the `stramash/<gameid>/addteam` and `stramash/<gameid>/addplayer` messages. However, the entire game can be configured with one message by using the optional `teams` and `players` elements - for example:

>
    {
        "name":"test game",  
        "type":"teams",
        "maxtime":"00:15:00",
        "teams":[
            {
                "name":"The A Team",
                "colour":[255,0,0],
                "players":[
                    {
                        "name":"player1",
                        "gunid":"123"
                    },
                    {
                        "name":"player2",
                        "gunid":"124"
                    }
                ]
            },
            {
                "name":"The B Team",
                "colour":[0,0,255],
                "players":[
                    {
                        "name":"player3",
                        "gunid":"125"
                    },
                    {
                        "name":"player4",
                        "gunid":"126"
                    }
                ]
            }
        ]
    }

Note that you can also provide a list of teams without players, or a list of players without teams (in which case you must specify a colour for each player).

**Delete Game**  

Topic: `stramash/<gameid>/delete`

Requests deletion of a game.

**Start Game**

Topic: `game/<gameid>/startgame`

Requests that the game be started.

+-----------------------+
    | stramas               | \-                    | Requests end of a     |
    | h/game/\<gameid\>/end |                       | game                  |
    +-----------------------+-----------------------+-----------------------+
    | stramash/             | \-                    | Requests the state of |
    | game/\<gameid\>/check |                       | a game (triggers      |
    |                       |                       | gamestate message)    |
    +-----------------------+-----------------------+-----------------------+
    | Game-Related: Server  |                       |                       |
    | Announcements         |                       |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/gamecreated  | {                     | Announces creation of |
    |                       |                       | a new game.           |
    |                       | \"id\": \<gameid\>,   |                       |
    |                       |                       |                       |
    |                       | \"name\": \<game      |                       |
    |                       | name\>,               |                       |
    |                       |                       |                       |
    |                       | \"type\": \<game      |                       |
    |                       | type\>,               |                       |
    |                       |                       |                       |
    |                       | \"maxtime\": \<max    |                       |
    |                       | time\>                |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **id**:               |                       |
    |                       | globally-unique       |                       |
    |                       | indentifier for the   |                       |
    |                       | game.                 |                       |
    |                       |                       |                       |
    |                       | **name**: descriptive |                       |
    |                       | name for the game.    |                       |
    |                       |                       |                       |
    |                       | **type** is the type  |                       |
    |                       | of game -- eg         |                       |
    |                       | free-for-all, n-up,   |                       |
    |                       | battle royale         |                       |
    |                       |                       |                       |
    |                       | **maxtime**: maximum  |                       |
    |                       | duration of the game, |                       |
    |                       | in the format         |                       |
    |                       | hh:mm:ss              |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | \-                    | Announces deletion of |
    | <gameid\>/gamedeleted |                       | a game                |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | \-                    | Announces the start   |
    | <gameid\>/gamestarted |                       | of a game             |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | \-                    | Announces the end of  |
    | /\<gameid\>/gameended |                       | a game                |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | {                     | Announces the current |
    | /\<gameid\>/gamestate |                       | state of a game       |
    |                       | \"name\": \<gameid\>, |                       |
    |                       |                       |                       |
    |                       | \"type\": \<game      |                       |
    |                       | type\>,               |                       |
    |                       |                       |                       |
    |                       | \"maxtime\": \<max    |                       |
    |                       | time\>,               |                       |
    |                       |                       |                       |
    |                       | \"runtime\":          |                       |
    |                       | \<*runtime*\>,        |                       |
    |                       |                       |                       |
    |                       | \"status\":           |                       |
    |                       | \<*status*\>          |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **name**: the human   |                       |
    |                       | name of the game      |                       |
    |                       |                       |                       |
    |                       | **type**: game type   |                       |
    |                       | (eg free-for-all,     |                       |
    |                       | n-up, battle royale   |                       |
    |                       | etc)                  |                       |
    |                       |                       |                       |
    |                       | **maxtime**: the      |                       |
    |                       | maximum game time     |                       |
    |                       | (hh:mm:ss), empty if  |                       |
    |                       | no limit              |                       |
    |                       |                       |                       |
    |                       | **runtime**: the time |                       |
    |                       | the game has been     |                       |
    |                       | running (hh:mm:ss)    |                       |
    |                       |                       |                       |
    |                       | **status**: the       |                       |
    |                       | current state of the  |                       |
    |                       | game (unstarted,      |                       |
    |                       | active, finished)     |                       |
    +-----------------------+-----------------------+-----------------------+

### Team-Related Messages
TODO: reformat these nasty tables

    +-----------------------+-----------------------+-----------------------+
    | Topic                 | **Message Format**    | Notes                 |
    +-----------------------+-----------------------+-----------------------+
    | Team-Related:         |                       |                       |
    | Requests to Server    |                       |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/ga           | {                     | Requests the creation |
    | me/\<gameid\>/addteam |                       | of a team             |
    |                       | \"name\": \<team      |                       |
    |                       | name\>,               |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | name: descriptive     |                       |
    |                       | name for the team     |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255) describing the |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\]. The    |                       |
    |                       | server will not       |                       |
    |                       | distinguish between   |                       |
    |                       | similar or identical  |                       |
    |                       | colours -- it is the  |                       |
    |                       | team creator's        |                       |
    |                       | responsibility to     |                       |
    |                       | ensure that each      |                       |
    |                       | colour is             |                       |
    |                       | sufficiently unique.  |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/        | \<teamid\>            | Requests the deletion |
    | \<gameid\>/deleteteam |                       | of a team             |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | \<teamid\>            | Requests the status   |
    | /\<gameid\>/checkteam |                       | of a team             |
    |                       | In response, the      |                       |
    |                       | server will send the  |                       |
    |                       | **teamstate**         |                       |
    |                       | message.              |                       |
    +-----------------------+-----------------------+-----------------------+
    | Team-Related: Server  |                       |                       |
    | Announcements         |                       |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | {                     | Announces the         |
    | /\<gameid\>/teamadded |                       | creation of a new     |
    |                       | \"id\": \<teamid\>,   | team                  |
    |                       |                       |                       |
    |                       | \"name\": \<team      |                       |
    |                       | name\>,               |                       |
    |                       |                       |                       |
    |                       | \"number\": \<team    |                       |
    |                       | *\# 0-255*\>,         |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | \"*players*\":        |                       |
    |                       | *\[\<id\>, \<id\>,    |                       |
    |                       | \<id\>\...\]*         |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | id: unique identifier |                       |
    |                       | for the team          |                       |
    |                       |                       |                       |
    |                       | name: descriptive     |                       |
    |                       | name for the team     |                       |
    |                       |                       |                       |
    |                       | number: the team      |                       |
    |                       | number (0-255) used   |                       |
    |                       | in IR messages        |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255)describing the  |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\].        |                       |
    |                       |                       |                       |
    |                       | players: array        |                       |
    |                       | containing the        |                       |
    |                       | playerids for each    |                       |
    |                       | player currently      |                       |
    |                       | assigned to the team. |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | id                    | Announces the         |
    | <gameid\>/teamdeleted |                       | deletion of a team    |
    |                       | The id of the deleted |                       |
    |                       | team.                 |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | {                     | Announces the current |
    | /\<gameid\>/teamstate |                       | state of a team.      |
    |                       | \"id\": \<teamid\>,   |                       |
    |                       |                       |                       |
    |                       | \"name\": \<team      |                       |
    |                       | name\>,               |                       |
    |                       |                       |                       |
    |                       | \"number\": \<team    |                       |
    |                       | *\# 0-255*\>,         |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | \"*players*\":        |                       |
    |                       | *\[\<id\>, \<id\>,    |                       |
    |                       | \<id\>\...\]*         |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | id: unique identifier |                       |
    |                       | for the team          |                       |
    |                       |                       |                       |
    |                       | name: descriptive     |                       |
    |                       | name for the team     |                       |
    |                       |                       |                       |
    |                       | number: the team      |                       |
    |                       | number (0-255) used   |                       |
    |                       | in IR messages        |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255)describing the  |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\].        |                       |
    |                       |                       |                       |
    |                       | players: array        |                       |
    |                       | containing the        |                       |
    |                       | playerids for each    |                       |
    |                       | player currently      |                       |
    |                       | assigned to the team. |                       |
    +-----------------------+-----------------------+-----------------------+

### Player-Related Messages
TODO: reformat these nasty tables

    +-----------------------+-----------------------+-----------------------+
    | Topic                 | **Message Format**    | Notes                 |
    +-----------------------+-----------------------+-----------------------+
    | **Player-Related:     |                       |                       |
    | Requests to Server**  |                       |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | {                     | Requests the creation |
    | /\<gameid\>/addplayer |                       | of a player.          |
    |                       | \"name\":             |                       |
    |                       | \<descriptive name\>, |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **id**: the unique ID |                       |
    |                       | of the player         |                       |
    |                       |                       |                       |
    |                       | **name**: the         |                       |
    |                       | descriptive name of   |                       |
    |                       | the player            |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/        | \<id\>                | Requests a player to  |
    | \<gameid\>/kickplayer |                       | be kicked out of the  |
    |                       | The ID of the player  | game.                 |
    |                       | being kicked.         |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/g            | {                     | Requests a player to  |
    | ame/\<gameid\>/assign |                       | be assigned to a      |
    |                       | \"player\": \<player  | team.                 |
    |                       | id\>,                 |                       |
    |                       |                       |                       |
    |                       | \"team\": \<team      |                       |
    |                       | id\>,                 |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **player**: the ID of |                       |
    |                       | the player being      |                       |
    |                       | assigned.             |                       |
    |                       |                       |                       |
    |                       | **team**: the ID of   |                       |
    |                       | the team the player   |                       |
    |                       | is being assigned to. |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/gam          | \<id\>                | Requests a player to  |
    | e/\<gameid\>/unassign |                       | be unassigned from    |
    |                       | The ID of the player  | all teams.            |
    |                       | being unassigned.     |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/gam          | \<id\>                | Requests a player to  |
    | e/\<gameid\>/upplayer |                       | be activated.         |
    |                       | The ID of the player  |                       |
    |                       | being activated.      |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/        | \<id\>                | Requests a player to  |
    | \<gameid\>/downplayer |                       | be deactivated.       |
    |                       | The ID of the player  |                       |
    |                       | being deactivated.    |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | \<id\>                | Requests details of a |
    | <gameid\>/checkplayer |                       | particular player.    |
    |                       | The ID of the player  |                       |
    |                       | whose state is being  |                       |
    |                       | requested. Server     |                       |
    |                       | will respond with the |                       |
    |                       | **playerstate**       |                       |
    |                       | message.              |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | {                     | Announces that a      |
    | <gameid\>/playeradded |                       | player has been added |
    |                       | \"id\": \<player      | to the game.          |
    |                       | id\>,\                |                       |
    |                       | \"name\":             |                       |
    |                       | \<descriptive name\>, |                       |
    |                       |                       |                       |
    |                       | \"playernumber\":     |                       |
    |                       | \<*player \#          |                       |
    |                       | 0-255*\>,             |                       |
    |                       |                       |                       |
    |                       | \"teamnumber\":       |                       |
    |                       | \<*team \# 0-255*\>,  |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | \"shots\": \<num      |                       |
    |                       | shots fired\>,        |                       |
    |                       |                       |                       |
    |                       | \"kills\": \<num      |                       |
    |                       | kills made\>,         |                       |
    |                       |                       |                       |
    |                       | \"ffkills\": \<num    |                       |
    |                       | kills made\>,         |                       |
    |                       |                       |                       |
    |                       | \"deaths\": \<num     |                       |
    |                       | times killed\>,       |                       |
    |                       |                       |                       |
    |                       | \"score\": \<score\>, |                       |
    |                       |                       |                       |
    |                       | \"status\":           |                       |
    |                       | \<status\>            |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **id**: the unique ID |                       |
    |                       | of the player         |                       |
    |                       |                       |                       |
    |                       | **name**: the         |                       |
    |                       | descriptive name of   |                       |
    |                       | the player            |                       |
    |                       |                       |                       |
    |                       | **playernumber**: the |                       |
    |                       | number (0-255) of the |                       |
    |                       | player, used in IR    |                       |
    |                       | messages. -1 if not   |                       |
    |                       | set.                  |                       |
    |                       |                       |                       |
    |                       | **teamnumber**: the   |                       |
    |                       | number (0-255) of the |                       |
    |                       | team, used in IR      |                       |
    |                       | messages. -1 if not   |                       |
    |                       | set.                  |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255)describing the  |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\].        |                       |
    |                       | \[0,0,0\] (black) if  |                       |
    |                       | not set.              |                       |
    |                       |                       |                       |
    |                       | **shots**: the number |                       |
    |                       | of shots the player   |                       |
    |                       | has fired.            |                       |
    |                       |                       |                       |
    |                       | **kills**: the number |                       |
    |                       | of enemies the player |                       |
    |                       | has killed.           |                       |
    |                       |                       |                       |
    |                       | **ffkills**: the      |                       |
    |                       | number of 'friendly   |                       |
    |                       | fire' kills the       |                       |
    |                       | player has scored.    |                       |
    |                       |                       |                       |
    |                       | **deaths**: the       |                       |
    |                       | number of times the   |                       |
    |                       | player has been       |                       |
    |                       | killed.               |                       |
    |                       |                       |                       |
    |                       | **score**: the        |                       |
    |                       | player's score.       |                       |
    |                       |                       |                       |
    |                       | **status**: the       |                       |
    |                       | current status of the |                       |
    |                       | player (up, down or   |                       |
    |                       | kicked)               |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\<      | \<id\>                | Announces that a      |
    | gameid\>/playerkicked |                       | player has been       |
    |                       | The ID of the player  | kicked out of the     |
    |                       | being kicked.         | game.                 |
    +-----------------------+-----------------------+-----------------------+
    | stramash/gam          | {                     | Announces that a      |
    | e/\<gameid\>/assigned |                       | player has been       |
    |                       | \"player\": \<player  | assigned to a team.   |
    |                       | id\>,                 |                       |
    |                       |                       |                       |
    |                       | \"team\": \<team id\> |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **player**: the ID of |                       |
    |                       | the player being      |                       |
    |                       | assigned.             |                       |
    |                       |                       |                       |
    |                       | **team**: the ID of   |                       |
    |                       | the team the player   |                       |
    |                       | is being assigned to. |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/        | \<id\>                | Announces that the    |
    | \<gameid\>/unassigned |                       | player is no longer   |
    |                       | The ID of the player  | assigned to a team.   |
    |                       | being unassigned.     |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/gam          | \<id\>                | Announces that a      |
    | e/\<gameid\>/playerup |                       | player has been made  |
    |                       | The ID of the player  | active.               |
    |                       | being activated.      |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/        | \<id\>                | Announces that a      |
    | \<gameid\>/playerdown |                       | player has been       |
    |                       | The ID of the player  | deactivated           |
    |                       | being deactivated.    |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | {                     | Announces the current |
    | <gameid\>/playerstate |                       | state of a player.    |
    |                       | \"id\": \<player      |                       |
    |                       | id\>,\                |                       |
    |                       | \"name\":             |                       |
    |                       | \<descriptive name\>, |                       |
    |                       |                       |                       |
    |                       | \"playernumber\":     |                       |
    |                       | \<player \# 0-255\>,  |                       |
    |                       |                       |                       |
    |                       | \"teamnumber\":       |                       |
    |                       | \<team \# 0-255\>,    |                       |
    |                       |                       |                       |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | \"shots\": \<num      |                       |
    |                       | shots fired\>,        |                       |
    |                       |                       |                       |
    |                       | \"kills\": \<num      |                       |
    |                       | kills made\>,         |                       |
    |                       |                       |                       |
    |                       | \"ffkills\": \<num    |                       |
    |                       | kills made\>,         |                       |
    |                       |                       |                       |
    |                       | \"deaths\": \<num     |                       |
    |                       | times killed\>,       |                       |
    |                       |                       |                       |
    |                       | \"score\": \<score\>, |                       |
    |                       |                       |                       |
    |                       | \"status\":           |                       |
    |                       | \<status\>            |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **id**: the unique ID |                       |
    |                       | of the player         |                       |
    |                       |                       |                       |
    |                       | **name**: the         |                       |
    |                       | descriptive name of   |                       |
    |                       | the player            |                       |
    |                       |                       |                       |
    |                       | **playernumber**: the |                       |
    |                       | number (0-255) of the |                       |
    |                       | player, used in IR    |                       |
    |                       | messages              |                       |
    |                       |                       |                       |
    |                       | **teamnumber**: the   |                       |
    |                       | number (0-255) of the |                       |
    |                       | team, used in IR      |                       |
    |                       | messages              |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255)describing the  |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\].        |                       |
    |                       |                       |                       |
    |                       | **shots**: the number |                       |
    |                       | of shots the player   |                       |
    |                       | has fired.            |                       |
    |                       |                       |                       |
    |                       | **kills**: the number |                       |
    |                       | of enemies the player |                       |
    |                       | has killed.           |                       |
    |                       |                       |                       |
    |                       | **ffkills**: the      |                       |
    |                       | number of 'friendly   |                       |
    |                       | fire' kills the       |                       |
    |                       | player has scored.    |                       |
    |                       |                       |                       |
    |                       | **deaths**: the       |                       |
    |                       | number of times the   |                       |
    |                       | player has been       |                       |
    |                       | killed.               |                       |
    |                       |                       |                       |
    |                       | **score**: the        |                       |
    |                       | player's score.       |                       |
    |                       |                       |                       |
    |                       | **status**: the       |                       |
    |                       | current status of the |                       |
    |                       | player. This is a     |                       |
    |                       | bitfield:             |                       |
    |                       |                       |                       |
    |                       | 1 = INGAME            |                       |
    |                       |                       |                       |
    |                       | 2 = INTEAM            |                       |
    |                       |                       |                       |
    |                       | 4 = UP                |                       |
    |                       |                       |                       |
    |                       | 8 = KICKED            |                       |
    +-----------------------+-----------------------+-----------------------+
    | **Player-Related:     |                       |                       |
    | Server                |                       |                       |
    | Announcements**       |                       |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/player/\<    | {                     | Announces that a      |
    | playerid\>/gamejoined |                       | player has been added |
    |                       | \"name\": \<gameid\>, | to a game, with game  |
    |                       |                       | details.              |
    |                       | \"type\": \<game      |                       |
    |                       | type\>,               | Although this is      |
    |                       |                       | similar to the        |
    |                       | \"maxtime\": \<max    | **playeradded**       |
    |                       | time\>,               | announcement, it      |
    |                       |                       | allows the player to  |
    |                       | \"runtime\":          | see it even though    |
    |                       | \<*runtime*\>,        | they are not          |
    |                       |                       | subscribed to the     |
    |                       | \"status\":           | game's messages yet.  |
    |                       | \<*status*\>          | It also provides full |
    |                       |                       | details of the game.  |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | **name**: the human   |                       |
    |                       | name of the game      |                       |
    |                       |                       |                       |
    |                       | **type**: game type   |                       |
    |                       | (eg free-for-all,     |                       |
    |                       | n-up, battle royale   |                       |
    |                       | etc)                  |                       |
    |                       |                       |                       |
    |                       | **maxtime**: the      |                       |
    |                       | maximum game time     |                       |
    |                       | (hh:mm:ss), empty if  |                       |
    |                       | no limit              |                       |
    |                       |                       |                       |
    |                       | **runtime**: the time |                       |
    |                       | the game has been     |                       |
    |                       | running (hh:mm:ss)    |                       |
    |                       |                       |                       |
    |                       | **status**: the       |                       |
    |                       | current state of the  |                       |
    |                       | game (unstarted,      |                       |
    |                       | active, finished)     |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/player/\<    | {                     | Announces that a      |
    | playerid\>/*assigned* |                       | player has been added |
    |                       | \"id\": \<teamid\>,   | to a team.            |
    |                       |                       |                       |
    |                       | \"name\": \<team      | Although this is      |
    |                       | name\>,               | similar to the        |
    |                       |                       | **                    |
    |                       | \"teamnumber\":       | \<gameid\>/assigned** |
    |                       | \<team \# 0-255\>,    | announcement, it      |
    |                       |                       | provides full details |
    |                       | \"*player*number\":   | of the team (eg       |
    |                       | \<team \# 0-255\>,    | number, colour) to    |
    |                       |                       | the player.           |
    |                       | \"colour\":           |                       |
    |                       | \[\<red\>, \<green\>, |                       |
    |                       | \<blue\>\],           |                       |
    |                       |                       |                       |
    |                       | }                     |                       |
    |                       |                       |                       |
    |                       | id: unique identifier |                       |
    |                       | for the team          |                       |
    |                       |                       |                       |
    |                       | name: descriptive     |                       |
    |                       | name for the team     |                       |
    |                       |                       |                       |
    |                       | **teamnumber**: the   |                       |
    |                       | number of the player  |                       |
    |                       | used in IR messages.  |                       |
    |                       |                       |                       |
    |                       | **teamnumber**: the   |                       |
    |                       | number of the team    |                       |
    |                       | used in IR messages.  |                       |
    |                       |                       |                       |
    |                       | **colour**: an array  |                       |
    |                       | of integers (from     |                       |
    |                       | 0-255)describing the  |                       |
    |                       | team colour. The      |                       |
    |                       | first number is Red,  |                       |
    |                       | then Green, then      |                       |
    |                       | Blue. For example,    |                       |
    |                       | Yellow would be       |                       |
    |                       | represented as        |                       |
    |                       | \[255,255,0\].        |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/player/\<pl  | \-                    | Announces that the    |
    | ayerid\>/*unassigned* |                       | player has been       |
    |                       |                       | unassigned            |
    +-----------------------+-----------------------+-----------------------+
    | stramash/player       | \-                    | Announces that the    |
    | /\<playerid\>/deleted |                       | player has been       |
    |                       |                       | deleted               |
    +-----------------------+-----------------------+-----------------------+
    | stramash/playe        | \-                    | Announces that the    |
    | r/\<playerid\>/kicked |                       | player has been       |
    |                       |                       | kicked                |
    +-----------------------+-----------------------+-----------------------+
    | *stramash/pl          | \-                    | Announces that the    |
    | ayer/\<playerid\>/up* |                       | player has been made  |
    |                       |                       | active                |
    +-----------------------+-----------------------+-----------------------+
    | stramash/playe        | \-                    | Announces that the    |
    | r/\<playerid\>/*down* |                       | player has been made  |
    |                       |                       | inactive              |
    +-----------------------+-----------------------+-----------------------+

### Gameplay Messages
TODO: reformat these nasty tables

    +-----------------------+-----------------------+-----------------------+
    | Topic                 | **Message Format**    | Notes                 |
    +-----------------------+-----------------------+-----------------------+
    | stramash              | \<*id*\>              | Announces that a gun  |
    | /game/\<gameid\>/fire |                       | has been fired        |
    |                       | The playerid of the   |                       |
    |                       | player that fired.    |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramas               | \[\<s                 | Announces a hit       |
    | h/game/\<gameid\>/hit | hooterteam\>,\<shoote |                       |
    |                       | r\>,\<victimteam\>,\< |                       |
    |                       | victim\>,\<sensor\>\] |                       |
    |                       |                       |                       |
    |                       | **shooterteam**: the  |                       |
    |                       | team number (0-255)   |                       |
    |                       | of the player that    |                       |
    |                       | fired                 |                       |
    |                       |                       |                       |
    |                       | **shooter**: the      |                       |
    |                       | player number (0-255) |                       |
    |                       | of the player that    |                       |
    |                       | fired.                |                       |
    |                       |                       |                       |
    |                       | **victimteam**: the   |                       |
    |                       | team number (0-255)   |                       |
    |                       | of the player that    |                       |
    |                       | was hit               |                       |
    |                       |                       |                       |
    |                       | **victim**: the       |                       |
    |                       | player number (0-255) |                       |
    |                       | of the player that    |                       |
    |                       | was hit.              |                       |
    |                       |                       |                       |
    |                       | **sensor**: the id of |                       |
    |                       | the sensor recording  |                       |
    |                       | the hit.              |                       |
    +-----------------------+-----------------------+-----------------------+

### SFX Messages


Note: these messages will NOT be used in the prototype.

TODO: reformat these nasty tables

    +-----------------------+-----------------------+-----------------------+
    | Topic                 | **Message Format**    | Notes                 |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game/\       | true                  | Turns house lights on |
    | <gameid\>/houselights |                       | or off                |
    |                       | or                    |                       |
    |                       |                       |                       |
    |                       | false                 |                       |
    |                       |                       |                       |
    |                       | true for house lights |                       |
    |                       | on, false for house   |                       |
    |                       | lights off.           |                       |
    +-----------------------+-----------------------+-----------------------+
    | stramash/game         | \<name\>              | Plays a given message |
    | /\<gameid\>/playaudio |                       | over PA               |
    |                       | Requests a particular |                       |
    |                       | audio be played (eg   |                       |
    |                       | **gameover**). The    |                       |
    |                       | SFX server will       |                       |
    |                       | lookup the relevant   |                       |
    |                       | audio file and play   |                       |
    |                       | it.                   |                       |
    +-----------------------+-----------------------+-----------------------+

## Subscription Guidelines
TODO: reformat these nasty tables

Different parts of the system will be interested in different topics.
This section provides guidelines as to which components ought to
subscribe to which topics.

### Gun

TODO: reformat these nasty tables

    +-----------------------------------+-----------------------------------+
    | Topic                             | Gun Action                        |
    +-----------------------------------+-----------------------------------+
    | strama                            | Note gameid and subscribe to      |
    | sh/player/\<playerid\>/gamejoined | game-related messages:            |
    |                                   |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamestarted |
    |                                   |                                   |
    |                                   | s                                 |
    |                                   | tramash/game/\<gameid\>/gameended |
    |                                   |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamedeleted |
    |                                   |                                   |
    |                                   | Set INGAME status on, set         |
    |                                   | GAMEACTIVE based on status        |
    |                                   | received in message, update RGB   |
    |                                   | as appropriate.                   |
    +-----------------------------------+-----------------------------------+
    | stra                              | Note teamid, playerid and colour  |
    | mash/player/\<playerid\>/assigned | assignments. Set INTEAM status    |
    |                                   | on. Activate RGB appropriate for  |
    |                                   | team and gun state.               |
    +-----------------------------------+-----------------------------------+
    | strama                            | Zero teamid, playerid and colour  |
    | sh/player/\<playerid\>/unassigned | assignments. Set INTEAM status    |
    |                                   | off. Activate RGB appropriate for |
    |                                   | team and gun state.               |
    +-----------------------------------+-----------------------------------+
    | str                               | Set gun to initial state          |
    | amash/player/\<playerid\>/deleted | (state=0) and update RGB.         |
    +-----------------------------------+-----------------------------------+
    | st                                | Set gun to initial state          |
    | ramash/player/\<playerid\>/kicked | (state=0) and update RGB.         |
    +-----------------------------------+-----------------------------------+
    | stramash/player/\<playerid\>/up   | Set UP status on, update RGB and  |
    |                                   | otherwise go active.              |
    +-----------------------------------+-----------------------------------+
    | stramash/player/\<playerid\>/down | Set UP status off, update RGB and |
    |                                   | otherwise go inactive.            |
    +-----------------------------------+-----------------------------------+
    | str                               | Set GAMEACTIVE status on, update  |
    | amash/game/\<gameid\>/gamestarted | RGB.                              |
    +-----------------------------------+-----------------------------------+
    | s                                 | Set gun to initial state          |
    | tramash/game/\<gameid\>/gameended | (state=0) and update RGB.         |
    +-----------------------------------+-----------------------------------+
    | str                               | Set gun to initial state          |
    | amash/game/\<gameid\>/gamedeleted | (state=0) and update RGB.         |
    +-----------------------------------+-----------------------------------+

In addition to these, the gun will send the following topics:

TODO: reformat these nasty tables

    ------------------------------- -----------------------------------------------------
    Topic                           Gun Action
    stramash/game/\<gameid\>/fire   Sent when the player fires the gun.
    stramash/game/\<gameid\>/hit    Sent when the built-in sensor receives a valid hit.
  ------------------------------- -----------------------------------------------------

### Sensor

A sensor will generally need to subscribe to these topics:

TODO: reformat these nasty tables

    +-----------------------------------+-----------------------------------+
    | Topic                             | **Sensor** Action                 |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/gamejoined  | Note gameid and subscribe to      |
    |                                   | game-related messages:            |
    | qos=1                             |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamestarted |
    |                                   |                                   |
    |                                   | s                                 |
    |                                   | tramash/game/\<gameid\>/gameended |
    |                                   |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamedeleted |
    |                                   |                                   |
    |                                   | Set INGAME status on, set         |
    |                                   | GAMEACTIVE based on status        |
    |                                   | received in message, update RGB   |
    |                                   | as appropriate.                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/assigned    | Note teamid, playerid and colour  |
    |                                   | assignments. Set INTEAM status    |
    | qos=1                             | on. Activate RGB appropriate for  |
    |                                   | team and gun state.               |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/unassigned  | Zero teamid, playerid and colour  |
    |                                   | assignments. Set INTEAM status    |
    | qos=1                             | off. Activate RGB appropriate for |
    |                                   | team and gun state.               |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/deleted     | Set gun to initial state          |
    |                                   | (state=0) and update RGB.         |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/kicked      | Set gun to initial state          |
    |                                   | (state=0) and update RGB.         |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/up          | Set UP status on, update RGB and  |
    |                                   | otherwise go active.              |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<playerid\>/down        | Set UP status off, update RGB and |
    |                                   | otherwise go inactive.            |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<gameid\>/gamestarted   | Set GAMEACTIVE status on, update  |
    |                                   | RGB.                              |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<gameid\>/gameended     | Set gun to initial state          |
    |                                   | (state=0) and update RGB.         |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+
    | stramash/\<gameid\>/gamedeleted   | Set gun to initial state          |
    |                                   | (state=0) and update RGB.         |
    | qos=1                             |                                   |
    +-----------------------------------+-----------------------------------+

In addition to these, the sensor will send the following topics:

TODO: reformat these nasty tables

    +-------------------------+--------------------------------------------+
    |Topic                    |Gun Action                                  |
    |stramash/\<gameid\>/hit  |Sent when the sensor receives a valid hit.  |
    +-------------------------+--------------------------------------------+

### SFX Server

The SFX server messages will not be used in the prototypes.
Nevertheless, the protoype server should handle these messages

    +-----------------------------------+-----------------------------------+
    | Topic                             | **Sensor** Action                 |
    +-----------------------------------+-----------------------------------+
    | str                               | Note gameid and subscribe to      |
    | amash/sfx/\<serverid\>/gamejoined | game-related messages:            |
    |                                   |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamestarted |
    |                                   |                                   |
    |                                   | s                                 |
    |                                   | tramash/game/\<gameid\>/gameended |
    |                                   |                                   |
    |                                   | str                               |
    |                                   | amash/game/\<gameid\>/gamedeleted |
    +-----------------------------------+-----------------------------------+
    | str                               | Audio announce: 'game started'    |
    | amash/game/\<gameid\>/gamestarted |                                   |
    |                                   | Turn house lights off             |
    |                                   |                                   |
    |                                   | Smoke machine on intermittently?  |
    +-----------------------------------+-----------------------------------+
    | s                                 | Audio announce: 'game over'       |
    | tramash/game/\<gameid\>/gameended |                                   |
    |                                   | Turn house lights on              |
    |                                   |                                   |
    |                                   | Smoke machine on intermittently?  |
    |                                   |                                   |
    |                                   | If Stramash Royale: announce      |
    |                                   | winner(s).                        |
    |                                   |                                   |
    |                                   | If last man standing (time        |
    |                                   | remaining), ask them to to be     |
    |                                   | 'crowned' (ie master-blaster)     |
    |                                   |                                   |
    |                                   | Unsubscribe from                  |
    |                                   | stramash/game/... messages.       |
    +-----------------------------------+-----------------------------------+
    | str                               | Unsubscribe from                  |
    | amash/game/\<gameid\>/gamedeleted | stramash/game/... messages.       |
    +-----------------------------------+-----------------------------------+

### Game Monitor

TODO Limitation: only updated at game end.

### Server

TODO: Just subscribe to everything?

